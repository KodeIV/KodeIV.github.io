<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Minimal map</title>
    <link type ="text/css" rel="stylesheet" href= "/css/map.css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.12/d3.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3-geo-projection/0.2.9/d3.geo.projection.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.1.0/topojson.min.js"></script>
    <style>
      
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>

      var svg = d3.select("#map").append("svg").attr("viewBox", "0 0 1000 500");
      var projection = d3.geo.robinson().translate([500, 250]);
      var path = d3.geo.path().projection(projection);

      var world, cocaine;

      function cocaineMap(){
          
          var weLoveCoke = {};

          for (var j=0 ; j< cocaine.length; j++){
            
            var data = cocaine[j];
            var alpha2 = data["Alpha-2"];
            var countryName = data["Country name"];
            var retailPrice = data["Retail price"];
            var wholesalePrice = data["Wholesale price"];

              weLoveCoke[alpha2] = [retailPrice, wholesalePrice, countryName];
              
          }
          
          console.log(weLoveCoke);
          /*Object.keys(weLoveCoke).forEach (function(weLoveCoke){
            var retail = weLoveCoke[0]
            console.log(retail)
          })*/

          var countries = topojson.feature(world, world.objects["world.geo"]).features;

          for (var i=0; i<countries.length; i++) {


          svg.append("path").attr("fill","grey").attr("id", countries[i].id).attr("d", path(countries[i]))

          };
      };


      
      d3.json("/world.topo.json", function(loadWorld) {
          world = loadWorld;
          if (typeof cocaine !== undefined){ 
            cocaineMap();
          }
      });
        

      d3.csv("/cocaine.csv", function(loadData){
            cocaine = loadData;
            console.log(cocaine);
            if(typeof world !== undefined) {
              cocaineMap();
            }  
      });
        
    </script>

  </body>
</html>
